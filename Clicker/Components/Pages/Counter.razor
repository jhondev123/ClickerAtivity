@page "/counter"
@inject IHttpClientFactory HttpClientFactory

<h3>Counter</h3>

<p>Current count: @count</p>

<button class="btn btn-primary" @onclick="IncrementCount">Increment</button>

@code {
    private int count;
    private HttpClient Http => HttpClientFactory.CreateClient("ServerAPI");

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var result = await Http.GetFromJsonAsync<CounterResponse>("api/counter/current");
            if (result != null)
                count = result.Count;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching counter: {ex.Message}");
        }
    }

    private async Task IncrementCount()
    {
        Console.WriteLine("IncrementCount called"); // <-- teste

        try
        {
            var result = await Http.GetFromJsonAsync<int>($"api/counter/increment?value={count}");
            count = result;

        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error incrementing count: {ex.Message}");
        }
    }

    private class CounterResponse
    {
        public int Count { get; set; }
    }
}
